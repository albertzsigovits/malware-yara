// PR: https://github.com/VirusTotal/yara/pull/1732
// VT: vt.metadata.file_type == vt.FileType.LNK

import "lnk"

rule LNK_Test : lnk {
    meta:
        module = "lnk"
        filetype = "lnk"
        author = "albertzsigovits"
        threat = "YARA:LNK"
        description = ""
        url = "https://github.com/albertzsigovits/malware-yara/"
        reference = ""
        sha256 = ""
    condition:
        uint32be(0) == 0x4c000000 and uint32be(4) == 0x01140200 // LNK Magic and LNK Header
        and console.log("filesize is: ", filesize)
        and (console.log("lnk.ShellLinkHeader.ShowCommand is: ", lnk.ShellLinkHeader.ShowCommand) or true)
        and (console.log("lnk.ShellLinkHeader.IconIndex is: ", lnk.ShellLinkHeader.IconIndex) or true)
        and (console.log("lnk.LinkInfo.LocalBasePath is: ", lnk.LinkInfo.LocalBasePath) or true)
        and (console.log("lnk.LinkInfo.Local.DriveType is: ", lnk.LinkInfo.Local.DriveType) or true)
        and (console.log("lnk.LinkInfo.DriveSerialNumber is: ", lnk.LinkInfo.DriveSerialNumber) or true)
        and (console.log("lnk.LinkInfo.VolumeLabel is: ", lnk.LinkInfo.VolumeLabel) or true)
        and (console.log("lnk.Data.RelativePath is: ", lnk.Data.RelativePath) or true)
        and (console.log("lnk.Data.CommandLineArg is: ", lnk.Data.CommandLineArg) or true)
        and (console.log("lnk.Data.CommandLineArg.Length is: ", lnk.Data.CommandLineArg.Length) or true)
        and (console.log("lnk.Data.IconLocation is: ", lnk.Data.IconLocation) or true)
        and (console.log("lnk.ExtraBlocks.DistLinkTrackerBlocker.MachineID is: ", lnk.ExtraBlocks.DistLinkTrackerBlocker.MachineID) or true)
}
