// VT: vt.metadata.file_type == vt.FileType.LNK
// VT: tag:lnk

// PR: https://github.com/VirusTotal/yara/pull/1732
// RST: https://github.com/BitsOfBinary/yara/blob/lnk-module/docs/modules/lnk.rst

// For the time being, use the rule w/ https://github.com/BitsOfBinary/yara/tree/lnk-module branch

import "lnk"
import "console"

rule Debug_LNK : lnk debug {
    meta:
        module = "lnk"
        filetype = "lnk"
        author = "albertzsigovits"
        threat = "YARA:Debug.LNK"
        description = "Dump LNK information"
        url = "https://github.com/albertzsigovits/malware-yara/lnk/debug_lnk.yar"
        reference = "https://github.com/BitsOfBinary/yara/blob/lnk-module/docs/modules/lnk.rst"
        sha256 = ""
    condition:
        uint32be(0) == 0x4c000000 // LNK Magic
        and uint32be(4) == 0x01140200 // LNK Header
        and lnk.is_lnk // LNK per module
        and (console.log("lnk.CreationTime is: ", lnk.creation_time) or true)
        and (console.log("lnk.AcccessTime is: ", lnk.access_time) or true)
        and (console.log("lnk.WriteTime is: ", lnk.write_time) or true)
        and (console.log("lnk.FileSize is: ", lnk.file_size) or true)
        and (console.log("lnk.LinkFlags is: ", lnk.link_flags) or true)
        and (console.log("lnk.FileAttributesFlags is: ", lnk.file_attributes_flags) or true)
        and (console.log("lnk.ShellLinkHeader.ShowCommand is: ", lnk.show_command) or true)
        and (console.log("lnk.ShellLinkHeader.IconIndex is: ", lnk.icon_index) or true)
        and (console.log("lnk.LinkInfo.LocalBasePath is: ", lnk.link_info.local_base_path) or true)
        and (console.log("lnk.LinkInfo.Local.DriveType is: ", lnk.link_info.volume_id.drive_type) or true)
        and (console.log("lnk.LinkInfo.DriveSerialNumber is: ", lnk.link_info.volume_id.drive_serial_number) or true)
        and (console.log("lnk.LinkInfo.VolumeLabel is: ", lnk.link_info.volume_id.data) or true)
        and (console.log("lnk.Data.RelativePath is: ", lnk.relative_path) or true)
        and (console.log("lnk.Data.CommandLineArg is: ", lnk.command_line_arguments) or true)
        and (console.log("lnk.Data.IconLocation is: ", lnk.icon_location) or true)
        and (console.log("lnk.ExtraBlocks.DistLinkTrackerBlocker.MachineID is: ", lnk.tracker_data.machine_id) or true)
}
