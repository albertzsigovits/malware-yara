rule ESXi_Ransomware_Royal_params : linux malware ransomware royal esxi {
    meta:
        author = "albertzsigovits"
        created_date = "2023-02-03"
        last_updated_date = ""
        version = "0"
        filetype = "elf"
        threat = "ESXi.Ransomware.Royal.A"
        description = "Detection for Royal ransomware on ESXi"
        sha256 = "b57e5f0c857e807a03770feb4d3aa254d2c4c8c8d9e08687796be30e2093286c"
        sha256 = "06abc46d5dbd012b170c97d142c6b679183159197e9d3f6a76ba5e5abf999725"
    strings:
        $arg0 = "-id" ascii wide
        $arg1 = "-ep" ascii wide
        $arg2 = "-stopvm" ascii wide
        $arg3 = "-vmonly" ascii wide
        $arg4 = "-fork" ascii wide
        $arg5 = "-logs" ascii wide
        $cli = "esxcli" ascii wide
        $cmd = "vm process" ascii wide
        $action0 = "list" ascii wide
        $action1 = "kill" ascii wide
    condition:
        $cli
        and $cmd
        and 4 of ($arg*)
        and 1 of ($action*)
}
