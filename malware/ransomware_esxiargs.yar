rule ESXi_Ransomware_ESXiArgs_Generic : linux ransomware esxi esxiargs {
    meta:
        author = "albertzsigovits"
        created_date = "2023-02-08"
        last_updated_date = ""
        version = "0"
        filetype = "elf"
        threat = "Ransomware.ESXiArgs.A"
        description = "Rule to Detect Ransomware Attacks in ESXi"
        reference = "https://github.com/fastfire/IoC_Attack_ESXi_Feb_2023"
        reference = "https://blogs.blackberry.com/en/2023/02/esxiargs-ransomware-knocking-out-unpatched-vmware-esxi-linux-servers-worldwide"
    strings:
        $s01 = "usage: encrypt <public_key> <file_to_encrypt> [<enc_step>] [<enc_size>] [<file_size>]" ascii wide
        $s02 = "enc_step   -   number of MB to skip while encryption" ascii wide
        $s03 = "enc_size   -   number of MB in encryption block" ascii wide
        $s04 = "file_size  -   file size in bytes (for sparse files)" ascii wide
        $rsa1 = "RAND_pseudo_bytes" ascii wide
        $rsa2 = "open_read" ascii wide
        $rsa3 = "get_pk_data" ascii wide
        $rsa4 = "RSA_public_encrypt" ascii wide
        $rsa5 = "RSA_private_decrypt" ascii wide
        $rsa6 = "RSA_size" ascii wide
        $rsa7 = "rsa_encrypt" ascii wide
        $rsa8 = "create_rsa_obj" ascii wide
        $cry1 = "encrypt_file" ascii wide
        $cry2 = "encrypt_simple" ascii wide
        $cry3 = "encrypt_file" ascii wide
        $cry4 = "encrypt.c" ascii wide
        $sose1 = "sosemanuk.c" ascii wide
        $sose2 = "sosemanuk_internal" ascii wide
        $sose3 = "sosemanuk_encrypt" ascii wide
        $sose4 = "sosemanuk_schedule" ascii wide
        $sose5 = "sosemanuk_init" ascii wide
        $sose6 = "sosemanuk_prng" ascii wide
    condition:
        uint32(0) == 0x464c457f
        and 1 of ($s0*)
        and 4 of ($rsa*)
        and 2 of ($cry*)
        and 2 of ($sose*)
}
